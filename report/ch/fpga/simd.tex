\section{SIMD-nodes}

\TODO{This is very detailed and more of a documentation, rather than an
  explanation of how the SIMD nodes work. This section should be rewritten
  entirely (as per issue \#3).}

All SIMD nodes shares the same instruction set and execute instructions in
parallel. {\tt Word} size is 8 bit. Each SIMD node is fully equipped with
registers, an aritmetic logic unit (ALU), message passing and instruction
handling through the SIMD Node instruction set, which is explained within this
section.

The schematic of a SIMD node is shown in figure
\ref{fig:fpga-simd-arch}. \TODO{Talk around the figure}

\input{fig/fpga/fpga-simd-arch}

\subsection{Components}
In order to the keep the signals to a minimum, the SIMD node is nicely divided
into separate components which makes up the datapath for the node.

\subsection{Instruction Decoder}
The instruction decoder is the control component of a node. It takes the opcode
of the instruction and sets control signals for all the other components in the
node.

\subsection{I/O Controller}

\subsection{Register Bank}

\subsection{ALU}

\subsection{S Register}
The source data register, S REG for short, is a special purpose register within
the SIMD node. S REG holds the next source data for the node. It is partly
controlled by the instruction set for the node and partly controlled by a
special {\tt step} signal from the DMA.

This register also has the capability to receive data from the left node,
through the {\tt s\_in}-bus, and passing it along to node on the right through
the {\tt s\_out}-bus when instructed by the {\tt step} signal. This allows a
simultaneous data transfer while the node is busy processing.

Rising the value on the {\tt swap} control signal will write the result from the
ALU to the S\_REG and copy the data from the S\_REG out to the {\tt s\_new} bus,
ultimately writing this data to the register bank.

\subsection{State Register}

\subsection{Registers}
Each SIMD node have $2^4 = 16$ general purpose registers. 4 of these are
available for general storage when executing instructions. The remaining 2
registers are the special purpose registers {\tt \$zero} and {\tt \$state}.

\input{fig/fpga/simd-registers}

\subsection{State-register}

\subsection{Zero-register}

\subsection{BRAM and SRAM}
BRAM or SRAM is not available from the SIMD node.

\subsection{Instruction Set}

\input{fig/fpga/fpga-simd-datacom}\TODO{Split up into 3 figures instead?}


\subsection{Branching}
Since all nodes run the same instructions, both parts of a branch must be
executed. Nodes are setting the {\tt state} to 1 in order to indicate that they
are executing within that part of the branch.

\input{fig/fpga/single-level-branching}

\subsection{Multilevel branching}
Since state register is 8 it is possible to have up-to 8 nested branches by
shifting the current state to the left and adding the new state to the
end. Below \TODO{Refer to table, not relative to where it is placed} are the
instructions for performing a multilevel-branch.

\input{fig/fpga/multilevel-branching}
\CHECK{Could any of these tables be figures instead?}
