\section{Component Functionality}

This section describes the different components and their functionality. A list
of ordered parts can be found in \ref{app:ordered-parts}.
\TODO{Jahre vil ha figur(er)}

\subsection{System Control Unit}

The \acf{SCU} is used to control the \ac{LENA} architecture and as a user interface.
The SCU sends data and instructions from the \ac{SD} card to \ac{LENA}, which stores
it in it's data and instruction memory respectively. The \ac{SCU} also starts and stops \ac{LENA}'s program.

Selecting programs and data is done by the user interface on the \ac{SCU} using buttons as input
and \ac{LENA}'s VGA as output. 

\subsection{LENA}

NF4 constrained our high level choices on the image processor architecture:
There was a requirement that we had to have multiple cores arranged in a
matrix. As the matrix would perform image processing, it was natural for us to
choose a \ac{SIMD} architecture. Many image processing algorithms do the exact
same operation on every pixel, and having a \ac{SIMD} architecture reduces both
complexity and size needed per core on the \ac{FPGA} significantly.

Other design choices that followed was the introduction of a control core, a
\ac{DMA} and a \ac{VGA} controller. The control core is responsible for sending
data to the \ac{SIMD} nodes and the \ac{VGA} controller, whereas the \ac{DMA} is
responsible for writing data from the \ac{SIMD} nodes back into memory. The
\ac{VGA} controller is responsible for handling the \ac{VGA} memory and sending
the correct signals to the \ac{VGA} port. In addition, as the \ac{SIMD} nodes
usually depend heavily on their neighbor's data, we decided to have ``dummy
nodes'' outside the real \ac{SIMD} nodes. Their only function is to transmit
data to the edge nodes. As such, we can still utilize the edge nodes for
computation when neighbor data is needed.

\subsubsection{Memory}
The memory is split over three different chips: The data memory, the
instruction memory and the \ac{VGA} memory. All of the \ac{RAM} is asynchronous
\ac{SRAM}, based on previous projects success with
it\cite{berg2011festinalente} along with the speed. The main reason for this
choice was mostly due to frequent reading and writing, but also because a
larger \ac{SRAM} module was more costly than multiple smaller \ac{SRAM} modules
per \ac{MB}. An additional benefit from this is that the complexity is lowered:
Fewer potential collisions on \ac{RAM} reading and writing occurs since fewer
parts read and write to the different \ac{RAM} chips.

\subsubsection*{Instruction Memory}
We ended up with a 24-bit instruction set for both \ac{SIMD} nodes and the
control core. As we ended up with a 16-bit program counter, the maximal
instruction count would be 64,000 and the memory chip size is chosen on that
basis. While it may sound little, it is still more than enough. To see why,
note that the control core can start the image processing algorithm from the
beginning when the \ac{SIMD} nodes have finished processing the current data.
Also, we usually define algorithms for a single frame, without any concern
for the one coming after it. The program is simply restarted for every new frame,
reducing the amount of code needed and the complexity of the programs.

\todo{Isn't both data- and vga memory discussed in length later in the report?}
\subsubsection*{Data Memory}

\subsubsection*{VGA Memory}

\subsection{I/O}

